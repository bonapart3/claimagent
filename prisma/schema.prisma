// ClaimAgent Prisma Schema
// Enterprise-grade P&C Insurance Claims Platform
// Version: 3.0.0

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ============================================================================
// ENUMS
// ============================================================================

enum UserRole {
  ADMIN
  ADJUSTER
  SIU_SPECIALIST
  SUPERVISOR
  UNDERWRITER
  AGENT
  CUSTOMER
}

enum CarrierTier {
  SMALL
  REGIONAL
  MIDSIZE
}

enum PolicyStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  SUSPENDED
}

enum CoverageType {
  LIABILITY
  COLLISION
  COMPREHENSIVE
  UM_UIM
  MEDICAL_PAYMENTS
  RENTAL_REIMBURSEMENT
  ROADSIDE_ASSISTANCE
}

enum ClaimType {
  AUTO_LIABILITY
  AUTO_COLLISION
  AUTO_COMPREHENSIVE
  AUTO_UNINSURED_MOTORIST
  AUTO_PIP
  AUTO_MEDICAL_PAYMENTS
}

enum LossType {
  COLLISION
  THEFT
  VANDALISM
  WEATHER
  FIRE
  GLASS
  HIT_AND_RUN
  ANIMAL
  OTHER
}

enum Severity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum Complexity {
  SIMPLE
  MODERATE
  COMPLEX
}

enum ClaimStatus {
  INTAKE
  INVESTIGATION
  EVALUATION
  PENDING_APPROVAL
  APPROVED
  PAYMENT_PROCESSING
  CLOSED
  DENIED
  SUSPENDED
}

enum RoutingDecision {
  AUTO_APPROVED
  HUMAN_REVIEW
  SIU_ESCALATION
  SPECIALIST_REVIEW
  LEGAL_REVIEW
  DRAFT_DENIAL
}

enum ParticipantRole {
  INSURED
  CLAIMANT
  WITNESS
  OTHER_DRIVER
  PASSENGER
  PEDESTRIAN
  ATTORNEY
  MEDICAL_PROVIDER
}

enum DocumentType {
  PHOTO_VEHICLE
  PHOTO_SCENE
  POLICE_REPORT
  MEDICAL_RECORD
  REPAIR_ESTIMATE
  INVOICE
  RECEIPT
  CORRESPONDENCE
  LEGAL_DOCUMENT
  OTHER
}

enum CommunicationType {
  ACKNOWLEDGMENT
  INFO_REQUEST
  STATUS_UPDATE
  APPROVAL_LETTER
  DENIAL_LETTER
  RESERVATION_OF_RIGHTS
  SETTLEMENT_OFFER
  PAYMENT_NOTICE
  INTERNAL_NOTE
}

enum CommDirection {
  OUTBOUND
  INBOUND
}

enum CommStatus {
  DRAFT
  PENDING_APPROVAL
  SENT
  DELIVERED
  FAILED
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum PaymentMethod {
  CHECK
  ACH
  WIRE
  DEBIT_CARD
}

enum PaymentStatus {
  PENDING
  APPROVED
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum AgentStatus {
  SUCCESS
  FAILURE
  SKIPPED
  ESCALATED
}

enum HandbookType {
  CLAIMS_MANUAL
  SIU_PLAYBOOK
  CORRESPONDENCE_GUIDE
  UNDERWRITING_GUIDELINES
  STATE_SPECIFIC
  TRAINING_MATERIAL
}

// ============================================================================
// CORE ENTITIES
// ============================================================================

model Carrier {
  id                   String      @id @default(uuid())
  name                 String      @db.VarChar(255)
  code                 String      @unique @db.VarChar(50)
  annualWrittenPremium Decimal     @map("annual_written_premium") @db.Decimal(15, 2)
  licenseNumber        String      @map("license_number") @db.VarChar(100)
  domiciledState       String      @map("domiciled_state") @db.VarChar(2)
  isActive             Boolean     @default(true) @map("is_active")
  tier                 CarrierTier @default(REGIONAL)
  createdAt            DateTime    @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime    @updatedAt @map("updated_at") @db.Timestamptz

  users        User[]
  policies     Policy[]
  claims       Claim[]
  fraudRules   FraudRule[]
  handbooks    Handbook[]
  claimMetrics ClaimMetric[]

  @@index([code])
  @@index([isActive])
  @@map("carriers")
}

model User {
  id             String    @id @default(uuid())
  email          String    @unique @db.VarChar(255)
  passwordHash   String    @map("password_hash") @db.VarChar(255)
  firstName      String    @map("first_name") @db.VarChar(100)
  lastName       String    @map("last_name") @db.VarChar(100)
  role           UserRole
  carrierId      String?   @map("carrier_id")
  canAutoApprove Boolean   @default(false) @map("can_auto_approve")
  approvalLimit  Decimal?  @map("approval_limit") @db.Decimal(10, 2)
  lastLoginAt    DateTime? @map("last_login_at") @db.Timestamptz
  loginCount     Int       @default(0) @map("login_count")
  isActive       Boolean   @default(true) @map("is_active")
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  carrier   Carrier?   @relation(fields: [carrierId], references: [id])
  sessions  Session[]
  claims    Claim[]    @relation("AdjusterClaims")
  documents Document[]
  auditLogs AuditLog[]

  @@index([email])
  @@index([carrierId, role])
  @@map("users")
}

model Session {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  token     String   @unique @db.VarChar(500)
  expiresAt DateTime @map("expires_at") @db.Timestamptz
  ipAddress String?  @map("ip_address") @db.VarChar(45)
  userAgent String?  @map("user_agent")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@map("sessions")
}

// ============================================================================
// POLICY MANAGEMENT
// ============================================================================

model Policy {
  id              String       @id @default(uuid())
  policyNumber    String       @unique @map("policy_number") @db.VarChar(50)
  carrierId       String       @map("carrier_id")
  holderFirstName String       @map("holder_first_name") @db.VarChar(100)
  holderLastName  String       @map("holder_last_name") @db.VarChar(100)
  holderEmail     String?      @map("holder_email") @db.VarChar(255)
  holderPhone     String?      @map("holder_phone") @db.VarChar(20)
  holderAddress   Json         @map("holder_address")
  effectiveDate   DateTime     @map("effective_date") @db.Date
  expirationDate  DateTime     @map("expiration_date") @db.Date
  status          PolicyStatus @default(ACTIVE)
  annualPremium   Decimal      @map("annual_premium") @db.Decimal(10, 2)
  createdAt       DateTime     @default(now()) @map("created_at") @db.Timestamptz
  updatedAt       DateTime     @updatedAt @map("updated_at") @db.Timestamptz

  carrier   Carrier    @relation(fields: [carrierId], references: [id])
  coverages Coverage[]
  vehicles  Vehicle[]
  claims    Claim[]

  @@index([policyNumber])
  @@index([carrierId])
  @@index([status])
  @@index([effectiveDate, expirationDate])
  @@map("policies")
}

model Coverage {
  id                   String       @id @default(uuid())
  policyId             String       @map("policy_id")
  type                 CoverageType
  limitPerPerson       Decimal?     @map("limit_per_person") @db.Decimal(10, 2)
  limitPerAccident     Decimal?     @map("limit_per_accident") @db.Decimal(10, 2)
  limitProperty        Decimal?     @map("limit_property") @db.Decimal(10, 2)
  deductible           Decimal?     @db.Decimal(10, 2)
  uninsuredMotorist    Boolean      @default(false) @map("uninsured_motorist")
  underinsuredMotorist Boolean      @default(false) @map("underinsured_motorist")
  medicalPayments      Decimal?     @map("medical_payments") @db.Decimal(10, 2)
  createdAt            DateTime     @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime     @updatedAt @map("updated_at") @db.Timestamptz

  policy Policy @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@index([policyId, type])
  @@map("coverages")
}

model Vehicle {
  id                String    @id @default(uuid())
  policyId          String    @map("policy_id")
  vin               String    @unique @db.VarChar(17)
  year              Int
  make              String    @db.VarChar(50)
  model             String    @db.VarChar(50)
  trim              String?   @db.VarChar(50)
  color             String?   @db.VarChar(30)
  mileage           Int?
  msrp              Decimal?  @db.Decimal(10, 2)
  currentAcv        Decimal?  @map("current_acv") @db.Decimal(10, 2)
  lastValuationDate DateTime? @map("last_valuation_date") @db.Date
  hasSensors        Boolean   @default(false) @map("has_sensors")
  hasAdas           Boolean   @default(false) @map("has_adas")
  fuelType          String?   @map("fuel_type") @db.VarChar(30)
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  policy Policy  @relation(fields: [policyId], references: [id], onDelete: Cascade)
  claims Claim[]

  @@index([vin])
  @@index([policyId])
  @@map("vehicles")
}

// ============================================================================
// CLAIM MANAGEMENT
// ============================================================================

model Claim {
  id                   String           @id @default(uuid())
  claimNumber          String           @unique @map("claim_number") @db.VarChar(50)
  carrierId            String           @map("carrier_id")
  policyId             String           @map("policy_id")
  vehicleId            String?          @map("vehicle_id")
  adjusterId           String?          @map("adjuster_id")
  lossDate             DateTime         @map("loss_date") @db.Date
  reportedDate         DateTime         @default(now()) @map("reported_date") @db.Timestamptz
  lossLocation         Json             @map("loss_location")
  lossDescription      String           @map("loss_description")
  claimType            ClaimType        @map("claim_type")
  lossType             LossType         @map("loss_type")
  severity             Severity
  complexity           Complexity
  status               ClaimStatus      @default(INTAKE)
  subStatus            String?          @map("sub_status") @db.VarChar(50)
  estimatedLoss        Decimal?         @map("estimated_loss") @db.Decimal(10, 2)
  reserveAmount        Decimal?         @map("reserve_amount") @db.Decimal(10, 2)
  paidAmount           Decimal          @default(0) @map("paid_amount") @db.Decimal(10, 2)
  deductible           Decimal?         @db.Decimal(10, 2)
  isTotalLoss          Boolean          @default(false) @map("is_total_loss")
  isFraudulent         Boolean          @default(false) @map("is_fraudulent")
  fraudScore           Int              @default(0) @map("fraud_score")
  requiresHumanReview  Boolean          @default(false) @map("requires_human_review")
  autoApprovalEligible Boolean          @default(false) @map("auto_approval_eligible")
  routingDecision      RoutingDecision? @map("routing_decision")
  escalationReason     String?          @map("escalation_reason")
  acknowledgedAt       DateTime?        @map("acknowledged_at") @db.Timestamptz
  investigatedAt       DateTime?        @map("investigated_at") @db.Timestamptz
  evaluatedAt          DateTime?        @map("evaluated_at") @db.Timestamptz
  settledAt            DateTime?        @map("settled_at") @db.Timestamptz
  closedAt             DateTime?        @map("closed_at") @db.Timestamptz
  metadata             Json?
  createdAt            DateTime         @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime         @updatedAt @map("updated_at") @db.Timestamptz

  carrier        Carrier            @relation(fields: [carrierId], references: [id])
  policy         Policy             @relation(fields: [policyId], references: [id])
  vehicle        Vehicle?           @relation(fields: [vehicleId], references: [id])
  adjuster       User?              @relation("AdjusterClaims", fields: [adjusterId], references: [id])
  participants   ClaimParticipant[]
  documents      Document[]
  communications Communication[]
  fraudAnalysis  FraudAnalysis?
  valuation      Valuation?
  settlement     Settlement?
  agentLogs      AgentLog[]
  auditLogs      AuditLog[]

  @@index([claimNumber])
  @@index([carrierId])
  @@index([policyId])
  @@index([status])
  @@index([lossDate])
  @@index([fraudScore])
  @@index([requiresHumanReview])
  @@map("claims")
}

model ClaimParticipant {
  id                    String          @id @default(uuid())
  claimId               String          @map("claim_id")
  role                  ParticipantRole
  firstName             String          @map("first_name") @db.VarChar(100)
  lastName              String          @map("last_name") @db.VarChar(100)
  email                 String?         @db.VarChar(255)
  phone                 String?         @db.VarChar(20)
  address               Json?
  licenseNumber         String?         @map("license_number") @db.VarChar(50)
  licenseState          String?         @map("license_state") @db.VarChar(2)
  vehicleInfo           Json?           @map("vehicle_info")
  insuranceCarrier      String?         @map("insurance_carrier") @db.VarChar(255)
  insurancePolicyNumber String?         @map("insurance_policy_number") @db.VarChar(50)
  injuryDescription     String?         @map("injury_description")
  medicalTreatment      Boolean         @default(false) @map("medical_treatment")
  createdAt             DateTime        @default(now()) @map("created_at") @db.Timestamptz
  updatedAt             DateTime        @updatedAt @map("updated_at") @db.Timestamptz

  claim Claim @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@index([claimId, role])
  @@map("claim_participants")
}

// ============================================================================
// DOCUMENTS & EVIDENCE
// ============================================================================

model Document {
  id            String       @id @default(uuid())
  claimId       String       @map("claim_id")
  type          DocumentType
  fileName      String       @map("file_name") @db.VarChar(255)
  fileSize      Int          @map("file_size")
  mimeType      String       @map("mime_type") @db.VarChar(100)
  storageUrl    String       @map("storage_url")
  extractedText String?      @map("extracted_text")
  extractedData Json?        @map("extracted_data")
  ocrConfidence Float?       @map("ocr_confidence") @db.Real
  aiAnalysis    Json?        @map("ai_analysis")
  damageAreas   String[]     @map("damage_areas")
  estimatedCost Decimal?     @map("estimated_cost") @db.Decimal(10, 2)
  uploadedBy    String?      @map("uploaded_by")
  uploadedAt    DateTime     @default(now()) @map("uploaded_at") @db.Timestamptz
  verifiedAt    DateTime?    @map("verified_at") @db.Timestamptz
  createdAt     DateTime     @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime     @updatedAt @map("updated_at") @db.Timestamptz

  claim    Claim @relation(fields: [claimId], references: [id], onDelete: Cascade)
  uploader User? @relation(fields: [uploadedBy], references: [id])

  @@index([claimId, type])
  @@map("documents")
}

// ============================================================================
// COMMUNICATIONS
// ============================================================================

model Communication {
  id                String            @id @default(uuid())
  claimId           String            @map("claim_id")
  type              CommunicationType
  direction         CommDirection
  recipientEmail    String?           @map("recipient_email") @db.VarChar(255)
  recipientPhone    String?           @map("recipient_phone") @db.VarChar(20)
  recipientName     String?           @map("recipient_name") @db.VarChar(200)
  subject           String?           @db.VarChar(500)
  body              String
  template          String?           @db.VarChar(100)
  sentAt            DateTime?         @map("sent_at") @db.Timestamptz
  deliveredAt       DateTime?         @map("delivered_at") @db.Timestamptz
  openedAt          DateTime?         @map("opened_at") @db.Timestamptz
  status            CommStatus        @default(DRAFT)
  stateRequirements Json?             @map("state_requirements")
  createdAt         DateTime          @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime          @updatedAt @map("updated_at") @db.Timestamptz

  claim Claim @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@index([claimId, type])
  @@map("communications")
}

// ============================================================================
// FRAUD DETECTION
// ============================================================================

model FraudAnalysis {
  id                String    @id @default(uuid())
  claimId           String    @unique @map("claim_id")
  overallScore      Int       @default(0) @map("overall_score")
  riskLevel         RiskLevel @default(LOW) @map("risk_level")
  repeatedClaimant  Boolean   @default(false) @map("repeated_claimant")
  overlappingLoss   Boolean   @default(false) @map("overlapping_loss")
  stagingIndicators Boolean   @default(false) @map("staging_indicators")
  inconsistentStory Boolean   @default(false) @map("inconsistent_story")
  medicalFraudFlags Json?     @map("medical_fraud_flags")
  billingAnomalies  Boolean   @default(false) @map("billing_anomalies")
  rapidReporting    Boolean   @default(false) @map("rapid_reporting")
  excessiveClaims   Boolean   @default(false) @map("excessive_claims")
  flaggedReasons    String[]  @map("flagged_reasons")
  siuRecommendation String?   @map("siu_recommendation")
  siuReviewed       Boolean   @default(false) @map("siu_reviewed")
  siuReviewedAt     DateTime? @map("siu_reviewed_at") @db.Timestamptz
  siuNotes          String?   @map("siu_notes")
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  claim Claim @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@index([overallScore])
  @@index([riskLevel])
  @@map("fraud_analyses")
}

model FraudRule {
  id               String   @id @default(uuid())
  carrierId        String   @map("carrier_id")
  name             String   @db.VarChar(255)
  description      String
  ruleLogic        Json     @map("rule_logic")
  scoreImpact      Int      @map("score_impact")
  isActive         Boolean  @default(true) @map("is_active")
  triggeredCount   Int      @default(0) @map("triggered_count")
  truePositiveRate Float?   @map("true_positive_rate") @db.Real
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime @updatedAt @map("updated_at") @db.Timestamptz

  carrier Carrier @relation(fields: [carrierId], references: [id])

  @@index([carrierId, isActive])
  @@map("fraud_rules")
}

// ============================================================================
// VALUATION & SETTLEMENT
// ============================================================================

model Valuation {
  id                  String   @id @default(uuid())
  claimId             String   @unique @map("claim_id")
  preAccidentValue    Decimal  @map("pre_accident_value") @db.Decimal(10, 2)
  postAccidentValue   Decimal? @map("post_accident_value") @db.Decimal(10, 2)
  diminishedValue     Decimal? @map("diminished_value") @db.Decimal(10, 2)
  isTotalLoss         Boolean  @default(false) @map("is_total_loss")
  totalLossThreshold  Float?   @map("total_loss_threshold") @db.Real
  salvageValue        Decimal? @map("salvage_value") @db.Decimal(10, 2)
  estimatedRepairCost Decimal? @map("estimated_repair_cost") @db.Decimal(10, 2)
  actualRepairCost    Decimal? @map("actual_repair_cost") @db.Decimal(10, 2)
  laborCost           Decimal? @map("labor_cost") @db.Decimal(10, 2)
  partsCost           Decimal? @map("parts_cost") @db.Decimal(10, 2)
  valuationSource     String?  @map("valuation_source") @db.VarChar(100)
  apiResponse         Json?    @map("api_response")
  comparables         Json?
  valuedAt            DateTime @default(now()) @map("valued_at") @db.Timestamptz
  valuedBy            String?  @map("valued_by") @db.VarChar(100)
  createdAt           DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt           DateTime @updatedAt @map("updated_at") @db.Timestamptz

  claim Claim @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@map("valuations")
}

model Settlement {
  id                String        @id @default(uuid())
  claimId           String        @unique @map("claim_id")
  totalPaid         Decimal       @map("total_paid") @db.Decimal(10, 2)
  damageAmount      Decimal?      @map("damage_amount") @db.Decimal(10, 2)
  medicalAmount     Decimal?      @map("medical_amount") @db.Decimal(10, 2)
  rentalAmount      Decimal?      @map("rental_amount") @db.Decimal(10, 2)
  otherAmount       Decimal?      @map("other_amount") @db.Decimal(10, 2)
  deductibleApplied Decimal?      @map("deductible_applied") @db.Decimal(10, 2)
  paymentMethod     PaymentMethod @map("payment_method")
  paymentStatus     PaymentStatus @default(PENDING) @map("payment_status")
  checkNumber       String?       @map("check_number") @db.VarChar(50)
  transactionId     String?       @map("transaction_id") @db.VarChar(100)
  paidAt            DateTime?     @map("paid_at") @db.Timestamptz
  releaseObtained   Boolean       @default(false) @map("release_obtained")
  releaseDate       DateTime?     @map("release_date") @db.Date
  createdAt         DateTime      @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime      @updatedAt @map("updated_at") @db.Timestamptz

  claim Claim @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@index([paymentStatus])
  @@map("settlements")
}

// ============================================================================
// AGENT SYSTEM LOGS
// ============================================================================

model AgentLog {
  id              String      @id @default(uuid())
  claimId         String      @map("claim_id")
  agentName       String      @map("agent_name") @db.VarChar(100)
  agentGroup      String      @map("agent_group") @db.VarChar(50)
  phase           String      @db.VarChar(50)
  action          String      @db.VarChar(255)
  input           Json?
  output          Json?
  confidence      Float?      @db.Real
  status          AgentStatus @default(SUCCESS)
  errorMessage    String?     @map("error_message")
  executionTimeMs Int?        @map("execution_time_ms")
  createdAt       DateTime    @default(now()) @map("created_at") @db.Timestamptz

  claim Claim @relation(fields: [claimId], references: [id], onDelete: Cascade)

  @@index([claimId, agentName])
  @@index([phase, status])
  @@map("agent_logs")
}

// ============================================================================
// AUDIT & COMPLIANCE
// ============================================================================

model AuditLog {
  id          String   @id @default(uuid())
  entityType  String   @map("entity_type") @db.VarChar(50)
  entityId    String   @map("entity_id")
  claimId     String?  @map("claim_id")
  userId      String?  @map("user_id")
  actorType   String   @map("actor_type") @db.VarChar(20)
  action      String   @db.VarChar(50)
  description String
  beforeState Json?    @map("before_state")
  afterState  Json?    @map("after_state")
  ipAddress   String?  @map("ip_address") @db.VarChar(45)
  userAgent   String?  @map("user_agent")
  metadata    Json?
  timestamp   DateTime @default(now()) @db.Timestamptz

  claim Claim? @relation(fields: [claimId], references: [id], onDelete: SetNull)
  user  User?  @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([entityType, entityId])
  @@index([claimId])
  @@index([userId])
  @@index([timestamp])
  @@map("audit_logs")
}

// ============================================================================
// KNOWLEDGE BASE & HANDBOOKS
// ============================================================================

model Handbook {
  id               String       @id @default(uuid())
  carrierId        String       @map("carrier_id")
  title            String       @db.VarChar(255)
  type             HandbookType
  version          String       @db.VarChar(20)
  effectiveDate    DateTime     @map("effective_date") @db.Date
  content          String
  sections         Json
  indexed          Boolean      @default(false)
  vectorEmbeddings Json?        @map("vector_embeddings")
  isActive         Boolean      @default(true) @map("is_active")
  createdAt        DateTime     @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime     @updatedAt @map("updated_at") @db.Timestamptz

  carrier Carrier @relation(fields: [carrierId], references: [id])

  @@index([carrierId, type, isActive])
  @@map("handbooks")
}

// ============================================================================
// STATE REGULATIONS
// ============================================================================

model StateRegulation {
  id                 String   @id @default(uuid())
  state              String   @unique @db.VarChar(2)
  totalLossThreshold Float    @map("total_loss_threshold") @db.Real
  totalLossFormula   String   @map("total_loss_formula") @db.VarChar(50)
  allowsDv           Boolean  @default(false) @map("allows_dv")
  dvLimitations      String?  @map("dv_limitations")
  acknowledgmentDays Int      @map("acknowledgment_days")
  investigationDays  Int      @map("investigation_days")
  paymentDays        Int      @map("payment_days")
  requiresRor        Boolean  @default(false) @map("requires_ror")
  specialNotices     Json?    @map("special_notices")
  doiWebsite         String?  @map("doi_website") @db.VarChar(255)
  doiPhone           String?  @map("doi_phone") @db.VarChar(20)
  updatedAt          DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([state])
  @@map("state_regulations")
}

// ============================================================================
// ANALYTICS & REPORTING
// ============================================================================

model ClaimMetric {
  id                  String   @id @default(uuid())
  carrierId           String   @map("carrier_id")
  periodStart         DateTime @map("period_start") @db.Date
  periodEnd           DateTime @map("period_end") @db.Date
  totalClaims         Int      @map("total_claims")
  newClaims           Int      @map("new_claims")
  closedClaims        Int      @map("closed_claims")
  totalIncurred       Decimal  @map("total_incurred") @db.Decimal(15, 2)
  totalPaid           Decimal  @map("total_paid") @db.Decimal(15, 2)
  averageClaimCost    Decimal  @map("average_claim_cost") @db.Decimal(10, 2)
  autoApprovedCount   Int      @map("auto_approved_count")
  autoApprovalRate    Float    @map("auto_approval_rate") @db.Real
  avgCycleTimeHours   Float    @map("avg_cycle_time_hours") @db.Real
  fraudFlagsCount     Int      @map("fraud_flags_count")
  fraudConfirmedCount Int      @map("fraud_confirmed_count")
  fraudSavings        Decimal? @map("fraud_savings") @db.Decimal(10, 2)
  errorRate           Float    @map("error_rate") @db.Real
  customerSatScore    Float?   @map("customer_sat_score") @db.Real
  createdAt           DateTime @default(now()) @map("created_at") @db.Timestamptz

  carrier Carrier @relation(fields: [carrierId], references: [id])

  @@index([carrierId, periodStart])
  @@map("claim_metrics")
}
